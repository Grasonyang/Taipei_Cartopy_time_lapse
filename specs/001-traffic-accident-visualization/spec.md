# 功能規格：台北市113年A1/A2交通事故視覺化

**功能分支**：`001-traffic-accident-visualization`
**建立日期**：2025-11-09
**狀態**：草稿
**輸入**：使用者描述： "依照architectrue中規劃的任務"

## 使用者情境與測試 *(必要)*

### 使用者故事 1 - 資料擷取與ETL (優先度: P1)

使用者能夠自動從API或CSV檔案擷取台北市113年A1/A2交通事故資料，並執行ETL流程，將原始資料轉換為乾淨、可供分析的格式。

**為何此優先度**：此為所有視覺化功能的基礎，若無乾淨資料，後續步驟無法進行。

**獨立測試**：可透過檢查 `data/processed/taipei_113_clean.parquet` 檔案是否存在且內容符合預期格式，來獨立測試此功能。

**驗收情境**：

1.  **假設** 原始資料已存在於 `data/raw/`，**當** 執行ETL腳本，**則** 系統應在 `data/processed/` 目錄下產生一個 `taipei_113_clean.parquet` 檔案。
2.  **假設** `taipei_113_clean.parquet` 檔案已產生，**當** 讀取該檔案，**則** 其應包含 `acc_dt`, `hour`, `is_day` 等派生欄位，且經緯度、日期時間等欄位格式正確。

---

### 使用者故事 2 - 靜態統計圖表 (優先度: P2)

使用者能夠產生並查看依行政區及時間分佈的靜態統計圖表，以了解事故分佈的概況。

**為何此優先度**：提供對資料的初步洞察，是快速了解整體趨勢的關鍵。

**獨立測試**：可透過執行 `viz_stats.py` 腳本，並檢查 `outputs/figures/` 目錄下是否產生對應的PNG圖檔來測試。

**驗收情境**：

1.  **假設** 已有乾淨的資料，**當** 執行統計圖表產生腳本，**則** 系統應在 `outputs/figures/` 目錄下產生至少兩種圖表：行政區事故分佈圖與時間分佈圖。
2.  **假設** 圖表已產生，**當** 開啟圖表，**則** 圖表應正確顯示中文標籤，且內容與資料相符。

---

### 使用者故事 3 - 地圖散點圖 (優先度: P3)

使用者能夠在地圖上查看全市的事故分佈散點圖，並能依白天/夜晚區分不同的事故點。

**為何此優先度**：將事故資料與地理資訊結合，提供更直觀的空間分佈洞察。

**獨立測試**：可透過執行 `viz_map.py` 腳本，並檢查 `outputs/figures/` 目錄下是否產生 `tpe_accident_map.png` 圖檔來測試。

**驗收情境**：

1.  **假設** 已有乾淨的資料，**當** 執行地圖產生腳本，**則** 系統應在 `outputs/figures/` 目錄下產生一張包含台北市地圖的事故散點圖。
2.  **假設** 地圖已產生，**當** 開啟地圖，**則** 圖上應能清楚區分白天與夜晚的事故點，並正確顯示圖例。

---

### 使用者故事 4 - 縮時攝影動畫 (優先度: P4)

使用者能夠產生並觀看依日期推進的縮時攝影動畫，動態地觀察事故發生的時空變化。

**為何此優先度**：此為專案的核心亮點，能最生動地展示資料。

**獨立測試**：可透過執行 `animate.py` 腳本，並檢查 `outputs/videos/` 目錄下是否產生 `tpe113_timelapse.mp4` 影片檔來測試。

**驗收情境**：

1.  **假設** 已有乾淨的資料，**當** 執行動畫產生腳本，**則** 系統應在 `outputs/videos/` 目錄下產生一個MP4影片檔。
2.  **假設** 影片已產生，**當** 播放影片，**則** 影片應逐日顯示事故點，並在標題中顯示目前日期。

### 邊界案例

-   當原始資料中包含無效的經緯度或日期時間格式時，系統應如何處理？
-   當 `ffmpeg` 未安裝時，動畫儲存功能應如何提示使用者？

## 需求 *(必要)*

### 功能需求

-   **FR-001**: 系統必須能從API或CSV讀取交通事故資料。
-   **FR-002**: 系統必須能清理資料，包括處理遺失值、標準化欄位內容。
-   **FR-003**: 系統必須能根據原始資料派生出新的欄位，如 `acc_dt`, `hour`, `is_day`。
-   **FR-004**: 系統必須能產生依行政區劃分的事故統計長條圖。
-   **FR-005**: 系統必須能產生依時間（日/夜）分層的事故趨勢圖。
-   **FR-006**: 系統必須能使用Cartopy在地圖上繪製事故散點圖。
-   **FR-007**: 系統必須能使用Matplotlib的FuncAnimation製作縮時攝影動畫。
-   **FR-008**: 系統必須能將產生的圖表儲存為PNG檔案，動畫儲存為MP4檔案。
-   **FR-009**: 系統必須支援在圖表中正確顯示中文字元。

### 關鍵實體

-   **交通事故 (Accident)**: 代表單一交通事故事件，包含屬性：事故日期、時間、行政區、類別(A1/A2)、光線、天候、車種、經度、緯度。

## 成功標準 *(必要)*

### 可衡量成果

-   **SC-001**: ETL流程能在5分鐘內處理完一整年的資料。
-   **SC-002**: 產生的所有靜態圖表（PNG）檔案大小應小於1MB。
-   **SC-003**: 產生的縮時攝影動畫（MP4）長度約為30秒（以每日為一幀，每秒12幀計算），檔案大小應小於20MB。
-   **SC-004**: 95%以上的事故資料點應能成功轉換並對應到地圖上的正確位置。
